<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Heart Rate Monitor</title>
    <link rel="stylesheet" href="css/css.css">
</head>
<body>
    <div class="heart-rate">
        <label for="bpm" id="BpmLabel"></label>
        <div class="heart-img-div">
            <img src="assets/heart.png" id="HeartImg">
        </div>
    </div>
</body>
<script>
    let bpm_label = document.getElementById("BpmLabel")
    let heart_img = document.getElementById("HeartImg")
    const DEFAULT_WIDTH = 128

    const min_size = 1.0
    const max_size = 1.2

    let current_bpm = 0.0

    var ws = new WebSocket("ws://localhost:8765/");

    ws.onopen = function(){
        console.log("Connection is Established");
    };

    ws.addEventListener("message", ({ data }) => {
        const event = JSON.parse(data);
        console.log(event)
        switch (event.type) {
            case "bpm_update":
                current_bpm = Number(event.value)
                beat_heart()
                update_bpm()
                console.log(current_bpm)
                break;
        }
    });
    // ws.onmessage = function(evt) {
    //     var received_msg = evt.data;
    //     current_bpm = Number(received_msg);
    //     beat_heart();
    //     update_bpm();

    //     console.log(current_bpm);
    // };

    function update_bpm() {
        bpm_label.innerText = current_bpm.toString();
    }

    function beat_heart() {
        heart_img.style.animationDuration = 60 / current_bpm + "s";
    }

</script>
</html>